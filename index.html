<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Juego Alem√°n Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colores Neon Premium */
            --der: #3b82f6;
            /* Azul el√©ctrico */
            --die: #f43f5e;
            /* Rosa intenso */
            --das: #22c55e;
            /* Verde ne√≥n */

            --bg-dark: #0f172a;
            /* Fondo principal muy oscuro */
            --card-dark: #1e293b;
            /* Fondo de tarjetas */
            --text-light: #f8fafc;
            /* Texto principal */
            --text-dim: #94a3b8;
            /* Texto secundario */
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
            color: var(--text-light);
            margin: 0;
            padding: 20px 20px 80px 20px;
            /* Padding bottom for navbar */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .game-wrapper {
            width: 100%;
            max-width: 400px;
            position: relative;
        }

        h3 {
            text-align: center;
            margin: 0 0 20px;
            color: var(--text-dim);
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Tabs / Screens */
        .screen {
            display: none;
            width: 100%;
            animation: fadeIn 0.3s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* GAME STYLES */
        .review-banner {
            background: linear-gradient(90deg, #7c3aed, #db2777);
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 800;
            font-size: 0.9rem;
            display: none;
            animation: slideDown 0.3s ease-out;
            box-shadow: 0 0 20px rgba(219, 39, 119, 0.4);
            letter-spacing: 0.5px;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            font-weight: 600;
            color: var(--text-dim);
            font-size: 0.95rem;
            background: rgba(30, 41, 59, 0.7);
            padding: 12px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .stat-val {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-val span {
            color: white;
            font-weight: 800;
        }

        .error-count {
            color: var(--die);
            text-shadow: 0 0 10px rgba(244, 63, 94, 0.4);
        }

        .progress-container {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin: 10px 0 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #ec4899);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .card {
            background: var(--card-dark);
            border-radius: 30px;
            padding: 50px 20px;
            text-align: center;
            border: 2px solid #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3), 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .word-de {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: white;
            letter-spacing: -1px;
            line-height: 1.1;
        }

        .word-es {
            font-size: 1.2rem;
            color: var(--text-dim);
            font-weight: 500;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            margin-bottom: 25px;
        }

        .btn {
            border: none;
            border-radius: 20px;
            padding: 22px 10px;
            font-size: 1.3rem;
            font-weight: 800;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            text-transform: lowercase;
        }

        .btn:active {
            transform: scale(0.94);
        }

        .btn-der {
            background: var(--der);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3), inset 0 2px 0 rgba(255, 255, 255, 0.2);
            border-bottom: 4px solid #2563eb;
        }

        .btn-die {
            background: var(--die);
            box-shadow: 0 0 20px rgba(244, 63, 94, 0.3), inset 0 2px 0 rgba(255, 255, 255, 0.2);
            border-bottom: 4px solid #e11d48;
        }

        .btn-das {
            background: var(--das);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3), inset 0 2px 0 rgba(255, 255, 255, 0.2);
            border-bottom: 4px solid #16a34a;
        }

        .btn:active {
            border-bottom-width: 0;
            margin-top: 4px;
        }

        .btn-review {
            width: 100%;
            background: transparent;
            color: var(--die);
            border: 2px solid var(--die);
            padding: 15px;
            border-radius: 18px;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 30px;
            display: none;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-review:active {
            transform: scale(0.98);
            background: rgba(244, 63, 94, 0.1);
        }

        .history-section {
            width: 100%;
            margin-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .history-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-dim);
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            opacity: 0.6;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            display: flex;
            align-items: center;
            background: rgba(30, 41, 59, 0.6);
            padding: 12px 15px;
            border-radius: 14px;
            font-size: 0.95rem;
            animation: slideIn 0.3s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        .hist-article {
            font-weight: 800;
            margin-right: 12px;
            text-transform: uppercase;
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 8px;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .hist-der {
            background: var(--der);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
        }

        .hist-die {
            background: var(--die);
            box-shadow: 0 0 10px rgba(244, 63, 94, 0.4);
        }

        .hist-das {
            background: var(--das);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
        }

        .hist-word {
            font-weight: 600;
            color: #e2e8f0;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .hist-plural {
            color: #64748b;
            font-size: 0.8rem;
            font-weight: 400;
            margin-top: 2px;
        }

        .hist-meaning {
            color: #94a3b8;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(8px);
            background: rgba(15, 23, 42, 0.85);
            /* Dark blur */
            z-index: 10;
        }

        .feedback-overlay.visible {
            opacity: 1;
        }

        .feedback-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            transform: scale(0);
            transition: transform 0.4s;
        }

        .feedback-overlay.visible .feedback-icon {
            transform: scale(1);
        }

        .feedback-text {
            font-size: 1.2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 10px;
            text-align: center;
            padding: 0 20px;
            line-height: 1.4;
        }

        .correct-answer-text {
            font-size: 1rem;
            color: #cbd5e1;
        }

        .shake {
            animation: shake 0.4s cubic-bezier(.36, .07, .19, .97) both;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-8px);
            }

            40% {
                transform: translateX(8px);
            }

            60% {
                transform: translateX(-4px);
            }

            80% {
                transform: translateX(4px);
            }
        }

        /* VOCAB LIST STYLES */
        .vocab-list-container {
            padding: 10px 0;
            width: 100%;
        }

        .list-category-header {
            margin: 20px 0 10px;
            color: var(--text-dim);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 800;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }

        .vocab-filter {
            width: 100%;
            background: var(--card-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 12px;
            color: white;
            margin-bottom: 10px;
            font-family: inherit;
        }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 5px;
            display: flex;
            gap: 5px;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .nav-btn {
            background: transparent;
            border: none;
            padding: 12px 25px;
            color: var(--text-dim);
            font-weight: 700;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn span {
            font-size: 0.9rem;
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        @media (max-height: 700px) {
            .card {
                padding: 30px 15px;
                margin-bottom: 20px;
            }

            .word-de {
                font-size: 2.2rem;
            }

            .btn {
                padding: 18px 10px;
            }

            body {
                padding-bottom: 70px;
            }

            .bottom-nav {
                bottom: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="game-wrapper">
        <h3>Sergio el bueno</h3>

        <!-- PANTALLA JUEGO -->
        <div id="screen-game" class="screen active">
            <div id="review-banner" class="review-banner">‚ö° MODO REPASO ACTIVO</div>

            <div class="stats-bar">
                <div class="stat-val">üî• <span id="streak">0</span></div>
                <div class="stat-val">‚ö†Ô∏è <span id="errors" class="error-count">0</span></div>
                <div class="stat-val">‚úÖ <span id="score">0</span></div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progress"></div>
            </div>

            <div class="card" id="card">
                <div class="word-de" id="word">...</div>
                <div class="word-es" id="meaning">...</div>

                <div class="feedback-overlay" id="feedback-overlay">
                    <div class="feedback-icon" id="feedback-icon"></div>
                    <div class="feedback-text" id="feedback-text"></div>
                    <div class="correct-answer-text" id="feedback-sub"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-der" onclick="handleInput('der')">der</button>
                <button class="btn btn-das" onclick="handleInput('das')">das</button>
                <button class="btn btn-die" onclick="handleInput('die')">die</button>
            </div>

            <button id="btn-review" class="btn-review" onclick="startReviewMode()">
                üîÑ Repasar mis Errores
            </button>

            <div class="history-section">
                <div class="history-title">√öltimas palabras</div>
                <div class="history-list" id="history-list"></div>
            </div>
        </div>

        <!-- PANTALLA LISTA -->
        <div id="screen-list" class="screen">
            <input type="text" class="vocab-filter" placeholder="üîç Buscar..." onkeyup="filterList(this.value)">

            <div class="vocab-list-container">
                <div class="history-list" id="full-vocab-list">
                    <!-- JS populate here -->
                </div>
            </div>
        </div>
    </div>

    <!-- NAVEGACION -->
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="switchScreen('game', this)">
            üéÆ <span>Juego</span>
        </button>
        <button class="nav-btn" onclick="switchScreen('list', this)">
            üìö <span>Lista</span>
        </button>
    </div>

    <script>
        const vocabulary = [
            // Transportes
            { category: "Transportes", word: "Bus", plural: "Busse", article: "der", meaning: "Autob√∫s" },
            { category: "Transportes", word: "Zug", plural: "Z√ºge", article: "der", meaning: "Tren" },
            { category: "Transportes", word: "Reisebus", plural: "Reisebusse", article: "der", meaning: "Autob√∫s de viaje" },
            { category: "Transportes", word: "Lastwagen", plural: "Lastwagen", article: "der", meaning: "Cami√≥n" },
            { category: "Transportes", word: "Hubschrauber", plural: "Hubschrauber", article: "der", meaning: "Helic√≥ptero" },
            { category: "Transportes", word: "U-Bahn", plural: "U-Bahnen", article: "die", meaning: "Metro" },
            { category: "Transportes", word: "Stra√üenbahn", plural: "Stra√üenbahnen", article: "die", meaning: "Tranv√≠a" },
            { category: "Transportes", word: "Fahrrad", plural: "Fahrr√§der", article: "das", meaning: "Bicicleta" },
            { category: "Transportes", word: "Moped", plural: "Mopeds", article: "das", meaning: "Ciclomotor" },
            { category: "Transportes", word: "Motorrad", plural: "Motorr√§der", article: "das", meaning: "Motocicleta" },
            { category: "Transportes", word: "Taxi", plural: "Taxis", article: "das", meaning: "Taxi" },
            { category: "Transportes", word: "Auto", plural: "Autos", article: "das", meaning: "Autom√≥vil" },
            { category: "Transportes", word: "Wohnmobil", plural: "Wohnmobile", article: "das", meaning: "Autocaravana" },
            { category: "Transportes", word: "Flugzeug", plural: "Flugzeuge", article: "das", meaning: "Avi√≥n" },
            { category: "Transportes", word: "Schiff", plural: "Schiffe", article: "das", meaning: "Barco" },
            { category: "Transportes", word: "Boot", plural: "Boote", article: "das", meaning: "Bote" },
            // Lugares
            { category: "Lugares", word: "Bahnhof", plural: "Bahnh√∂fe", article: "der", meaning: "Estaci√≥n de tren" },
            { category: "Lugares", word: "Hafen", plural: "H√§fen", article: "der", meaning: "Puerto" },
            { category: "Lugares", word: "Park", plural: "Parks", article: "der", meaning: "Parque" },
            { category: "Lugares", word: "Markt", plural: "M√§rkte", article: "der", meaning: "Mercado" },
            { category: "Lugares", word: "Marktplatz", plural: "Marktpl√§tze", article: "der", meaning: "Plaza del mercado" },
            { category: "Lugares", word: "Sportplatz", plural: "Sportpl√§tze", article: "der", meaning: "Campo deportivo" },
            { category: "Lugares", word: "Spielplatz", plural: "Spielpl√§tze", article: "der", meaning: "Parque infantil" },
            { category: "Lugares", word: "Supermarkt", plural: "Superm√§rkte", article: "der", meaning: "Supermercado" },
            { category: "Lugares", word: "Zoo", plural: "Zoos", article: "der", meaning: "Zool√≥gico" },
            { category: "Lugares", word: "Fluss", plural: "Fl√ºsse", article: "der", meaning: "R√≠o" },
            { category: "Lugares", word: "See", plural: "Seen", article: "der", meaning: "Lago" },
            { category: "Lugares", word: "Turm", plural: "T√ºrme", article: "der", meaning: "Torre" },
            { category: "Lugares", word: "Rathaus", plural: "Rath√§user", article: "das", meaning: "Ayuntamiento" },
            { category: "Lugares", word: "Theater", plural: "Theater", article: "das", meaning: "Teatro" },
            { category: "Lugares", word: "Museum", plural: "Museen", article: "das", meaning: "Museo" },
            { category: "Lugares", word: "Hotel", plural: "Hotels", article: "das", meaning: "Hotel" },
            { category: "Lugares", word: "Kino", plural: "Kinos", article: "das", meaning: "Cine" },
            { category: "Lugares", word: "Caf√©", plural: "Caf√©s", article: "das", meaning: "Cafeter√≠a" },
            { category: "Lugares", word: "Krankenhaus", plural: "Krankenh√§user", article: "das", meaning: "Hospital" },
            { category: "Lugares", word: "Schwimmbad", plural: "Schwimmb√§der", article: "das", meaning: "Piscina" },
            { category: "Lugares", word: "Konzerthaus", plural: "Konzerth√§user", article: "das", meaning: "Sala de conciertos" },
            { category: "Lugares", word: "Kirche", plural: "Kirchen", article: "die", meaning: "Iglesia" },
            { category: "Lugares", word: "Bank", plural: "Banken", article: "die", meaning: "Banco" },
            { category: "Lugares", word: "Post", plural: "Post", article: "die", meaning: "Correos" },
            { category: "Lugares", word: "Schule", plural: "Schulen", article: "die", meaning: "Escuela" },
            { category: "Lugares", word: "Bibliothek", plural: "Bibliotheken", article: "die", meaning: "Biblioteca" },
            { category: "Lugares", word: "Apotheke", plural: "Apotheken", article: "die", meaning: "Farmacia" },
            { category: "Lugares", word: "Bushaltestelle", plural: "Bushaltestellen", article: "die", meaning: "Parada de autob√∫s" },
            { category: "Lugares", word: "Polizei", plural: "-", article: "die", meaning: "Polic√≠a" },
            { category: "Lugares", word: "Toilette", plural: "Toiletten", article: "die", meaning: "Ba√±o" },
            { category: "Lugares", word: "Kunsthalle", plural: "Kunsthallen", article: "die", meaning: "Galer√≠a de arte" },
            { category: "Lugares", word: "Br√ºcke", plural: "Br√ºcken", article: "die", meaning: "Puente" },
            // Comida
            { category: "Comida", word: "Apfel", plural: "√Ñpfel", article: "der", meaning: "Manzana" },
            { category: "Comida", word: "Salat", plural: "Salate", article: "der", meaning: "Ensalada" },
            { category: "Comida", word: "K√§se", plural: "K√§se", article: "der", meaning: "Queso" },
            { category: "Comida", word: "Schinken", plural: "Schinken", article: "der", meaning: "Jam√≥n" },
            { category: "Comida", word: "Fisch", plural: "Fische", article: "der", meaning: "Pescado" },
            { category: "Comida", word: "Kuchen", plural: "Kuchen", article: "der", meaning: "Pastel" },
            { category: "Comida", word: "Reis", plural: "-", article: "der", meaning: "Arroz" },
            { category: "Comida", word: "Kaffee", plural: "Kaffees", article: "der", meaning: "Caf√©" },
            { category: "Comida", word: "Tee", plural: "Tees", article: "der", meaning: "T√©" },
            { category: "Comida", word: "Wein", plural: "Weine", article: "der", meaning: "Vino" },
            { category: "Comida", word: "Banane", plural: "Bananen", article: "die", meaning: "Pl√°tano" },
            { category: "Comida", word: "Birne", plural: "Birnen", article: "die", meaning: "Pera" },
            { category: "Comida", word: "Orange", plural: "Orangen", article: "die", meaning: "Naranja" },
            { category: "Comida", word: "Kartoffel", plural: "Kartoffeln", article: "die", meaning: "Patata" },
            { category: "Comida", word: "Tomate", plural: "Tomaten", article: "die", meaning: "Tomate" },
            { category: "Comida", word: "Gurke", plural: "Gurken", article: "die", meaning: "Pepino" },
            { category: "Comida", word: "Zwiebel", plural: "Zwiebeln", article: "die", meaning: "Cebolla" },
            { category: "Comida", word: "Milch", plural: "-", article: "die", meaning: "Leche" },
            { category: "Comida", word: "Butter", plural: "-", article: "die", meaning: "Mantequilla" },
            { category: "Comida", word: "Wurst", plural: "W√ºrste", article: "die", meaning: "Salchicha" },
            { category: "Comida", word: "Marmelade", plural: "Marmeladen", article: "die", meaning: "Mermelada" },
            { category: "Comida", word: "Suppe", plural: "Suppen", article: "die", meaning: "Sopa" },
            { category: "Comida", word: "Pizza", plural: "Pizzas", article: "die", meaning: "Pizza" },
            { category: "Comida", word: "Torte", plural: "Torten", article: "die", meaning: "Tarta" },
            { category: "Comida", word: "Gem√ºse", plural: "Gem√ºse", article: "das", meaning: "Verdura" },
            { category: "Comida", word: "Ei", plural: "Eier", article: "das", meaning: "Huevo" },
            { category: "Comida", word: "Fleisch", plural: "-", article: "das", meaning: "Carne" },
            { category: "Comida", word: "H√§hnchen", plural: "H√§hnchen", article: "das", meaning: "Pollo" },
            { category: "Comida", word: "Brot", plural: "Brote", article: "das", meaning: "Pan" },
            { category: "Comida", word: "Br√∂tchen", plural: "Br√∂tchen", article: "das", meaning: "Panecillo" },
            { category: "Comida", word: "Salz", plural: "Salze", article: "das", meaning: "Sal" },
            { category: "Comida", word: "Eis", plural: "-", article: "das", meaning: "Helado" },
            { category: "Comida", word: "Wasser", plural: "W√§sser", article: "das", meaning: "Agua" },
            { category: "Comida", word: "Bier", plural: "Biere", article: "das", meaning: "Cerveza" }
        ];

        let state = {
            currentIndex: 0,
            score: 0,
            streak: 0,
            deck: [],
            errors: [],
            isReviewMode: false
        };

        const els = {
            card: document.getElementById('card'),
            word: document.getElementById('word'),
            meaning: document.getElementById('meaning'),
            score: document.getElementById('score'),
            streak: document.getElementById('streak'),
            errors: document.getElementById('errors'),
            progress: document.getElementById('progress'),
            overlay: document.getElementById('feedback-overlay'),
            fbIcon: document.getElementById('feedback-icon'),
            fbText: document.getElementById('feedback-text'),
            fbSub: document.getElementById('feedback-sub'),
            btns: document.querySelectorAll('.btn'),
            historyList: document.getElementById('history-list'),
            btnReview: document.getElementById('btn-review'),
            banner: document.getElementById('review-banner'),
            fullList: document.getElementById('full-vocab-list')
        };

        function switchScreen(screenName, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${screenName}`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function init() {
            state.deck = shuffle([...vocabulary]);
            loadCard();
            renderFullList(vocabulary);
        }

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function startReviewMode() {
            if (state.errors.length === 0) return;
            state.isReviewMode = true;
            state.deck = shuffle([...state.errors]);
            state.currentIndex = 0;
            state.errors = [];
            els.banner.style.display = 'block';
            els.banner.textContent = `‚ö° REPASANDO ${state.deck.length} ERRORES`;
            els.btnReview.style.display = 'none';
            els.errors.textContent = 0;
            loadCard();
        }

        function endReviewMode() {
            state.isReviewMode = false;
            els.banner.style.display = 'none';
            state.deck = shuffle([...vocabulary]);
            state.currentIndex = 0;
            loadCard();
        }

        function loadCard() {
            if (state.currentIndex >= state.deck.length) {
                if (state.isReviewMode) {
                    alert("¬°Repaso completado! Volviendo al modo normal.");
                    endReviewMode();
                    return;
                }
                state.deck = shuffle([...vocabulary]);
                state.currentIndex = 0;
            }

            const item = state.deck[state.currentIndex];
            els.word.textContent = item.word;
            els.meaning.textContent = item.meaning;

            els.card.classList.remove('shake');
            els.overlay.classList.remove('visible');
            els.btns.forEach(b => b.disabled = false);

            const progress = (state.currentIndex / state.deck.length) * 100;
            els.progress.style.width = `${progress}%`;
        }

        function handleInput(choice) {
            const item = state.deck[state.currentIndex];
            const isCorrect = choice === item.article;

            els.btns.forEach(b => b.disabled = true);

            if (isCorrect) handleSuccess(item);
            else handleFail(item);

            addToHistory(item, isCorrect);
        }

        function addToHistory(item, isCorrect) {
            const div = document.createElement('div');
            div.className = 'history-item';
            div.style.borderLeft = isCorrect ? '4px solid #22c55e' : '4px solid #f43f5e';
            div.innerHTML = `
                <div class="hist-article hist-${item.article}">${item.article}</div>
                <div class="hist-word">
                    ${item.word}
                    <span class="hist-plural">${item.plural || '-'}</span>
                </div>
                <div class="hist-meaning">${item.meaning}</div>
            `;
            els.historyList.prepend(div);
            if (els.historyList.children.length > 10) els.historyList.removeChild(els.historyList.lastChild);
        }

        // TROLL MESSAGES ARRAYS
        const successMessages = [
            "¬øTe aplaudo o qu√©?", "Vaya, hoy te funciona el cerebro.", "No te flipes, ha sido suerte.",
            "Milagro... has acertado una.", "Seguro que miraste en Google.", "Hasta un reloj roto acierta...",
            "Te crees muy listo, ¬øno?", "Wow, qu√© logro... (sarcasmo)", "Al fin haces algo bien.",
            "No te acostumbres, crack.", "Demasiado f√°cil...", "¬øEso es todo lo que tienes?",
            "Soy una m√°quina.", "Ni he sudado.", "¬°Abran paso!", "Sin despeinarme.",
            "Pura calidad.", "Nivel Dios.", "Me aburro de ganar.", "Imparable.",
            "Venga, la siguiente fallas.", "¬øQuieres un pin?", "Pasable... por los pelos.",
            "No ha estado mal, supongo.", "Hoy est√°s inspirado, eh.", "Menos humos, Einstein.",
            "¬øQui√©n te ha soplado la respuesta?", "Vale, aceptamos barco.", "No cantes victoria a√∫n."
        ];

        const failMessages = [
            "¬øEres dalt√≥nico o solo lento?", "Madre m√≠a, qu√© verg√ºenza.", "¬øTe est√°s esforzando en ser malo?",
            "Mi calculadora tiene m√°s IQ.", "Borra el juego, en serio.", "Hasta mi abuela lo sab√≠a.",
            "Das un poco de pena, ¬øno?", "Mejor ded√≠cate al parch√≠s.", "Felicidades, eres un desastre.",
            "¬øEsa era tu respuesta? JAJAJA.", "¬øEn serio? ü§¶‚Äç‚ôÇÔ∏è", "Doli√≥ ver eso.",
            "Ponle voluntad...", "Mi sobrino sabe esa.", "Verg√ºenza ajena.",
            "Hoy no es tu d√≠a.", "¬øLe diste sin querer?", "A estudiar m√°s.",
            "Terrible... apocal√≠ptico.", "No das una, hijo m√≠o.", "¬øTe has le√≠do el manual?",
            "Vaya punter√≠a... de ciego.", "Error 404: Cerebro not found.", "Mejor suerte la pr√≥xima vida.",
            "¬øTe pagan por fallar?", "Eso ha sido doloroso.", "Mis ojos sangran.",
            "¬øEst√°s adivinando o qu√©?", "No... simplemente no."
        ];

        // Message Pools (Mutable copies)
        let availableSuccessMsgs = [...successMessages];
        let availableFailMsgs = [...failMessages];

        function getUniqueMessage(isSuccess) {
            // Select appropriate pool
            let pool = isSuccess ? availableSuccessMsgs : availableFailMsgs;
            const originalPool = isSuccess ? successMessages : failMessages;

            // Refill if empty
            if (pool.length === 0) {
                pool = [...originalPool];
                if (isSuccess) availableSuccessMsgs = pool;
                else availableFailMsgs = pool;
            }

            // Pick random index
            const randomIndex = Math.floor(Math.random() * pool.length);
            const message = pool[randomIndex];

            // Remove used message from pool
            pool.splice(randomIndex, 1);

            return message;
        }

        function handleSuccess(item) {
            if (!state.isReviewMode) state.score++;
            state.streak++;
            updateStats();
            showFeedback(true, item);
            setTimeout(() => { state.currentIndex++; loadCard(); }, 1200); // Little more time for Msg
        }

        function handleFail(item) {
            state.streak = 0;
            if (!state.errors.find(e => e.word === item.word)) state.errors.push(item);
            updateStats();
            els.card.classList.add('shake');
            showFeedback(false, item);
            if (state.errors.length > 0 && !state.isReviewMode) {
                els.btnReview.style.display = 'block';
                els.btnReview.textContent = `üîÑ Repasar mis ${state.errors.length} Errores`;
            }
            setTimeout(() => { state.currentIndex++; loadCard(); }, 2000); // More time to read insult
        }

        function showFeedback(isCorrect, item) {
            els.overlay.classList.add('visible');
            els.fbIcon.textContent = isCorrect ? 'üéâ' : '‚ùå';

            // Get unique non-repeating message
            els.fbText.textContent = getUniqueMessage(isCorrect);
            els.fbText.style.color = isCorrect ? '#22c55e' : '#f43f5e';

            els.fbSub.innerHTML = isCorrect ?
                `¬°Sigue as√≠!` :
                `La respuesta era <b style="color:var(--${item.article}); text-transform:uppercase">${item.article}</b> ${item.word}`;
        }

        function updateStats() {
            els.score.textContent = state.score;
            els.streak.textContent = state.streak;
            els.errors.textContent = state.errors.length;
        }

        // --- NEW CATEGORY LIST LOGIC ---
        function renderFullList(list) {
            els.fullList.innerHTML = '';

            // 1. Group by Category
            const groups = list.reduce((acc, item) => {
                if (!acc[item.category]) acc[item.category] = [];
                acc[item.category].push(item);
                return acc;
            }, {});

            // 2. Define Category Order
            const catOrder = ['Transportes', 'Lugares', 'Comida'];

            catOrder.forEach(cat => {
                if (!groups[cat]) return;

                // Add Header
                const header = document.createElement('div');
                header.className = 'list-category-header';
                header.textContent = cat;
                els.fullList.appendChild(header);

                // 3. Sort by Article (der, die, das) then Word
                const sortedItems = groups[cat].sort((a, b) => {
                    // Custom article order: der -> das -> die
                    const artOrder = { 'der': 1, 'das': 2, 'die': 3 };
                    if (artOrder[a.article] !== artOrder[b.article]) {
                        return artOrder[a.article] - artOrder[b.article];
                    }
                    return a.word.localeCompare(b.word);
                });

                sortedItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <div class="hist-article hist-${item.article}">${item.article}</div>
                        <div class="hist-word">
                            ${item.word}
                            <span class="hist-plural">${item.plural || '-'}</span>
                        </div>
                        <div class="hist-meaning">${item.meaning}</div>
                    `;
                    els.fullList.appendChild(div);
                });
            });
        }

        function filterList(query) {
            const lowerQ = query.toLowerCase();
            const filtered = vocabulary.filter(w =>
                w.word.toLowerCase().includes(lowerQ) ||
                w.meaning.toLowerCase().includes(lowerQ)
            );
            renderFullList(filtered);
        }

        init();
    </script>
</body>

</html>